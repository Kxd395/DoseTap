DoseTap
├─ Inputs
│  ├─ Flic 2 (BLE button → URL)
│  ├─ Apple Health (Sleep stages, HR/HRV/RR, Medications read)
│  └─ WHOOP API v2 (sleep & cycles history)
├─ Events
│  ├─ dose1 → schedule reminder
│  ├─ dose2 → clear reminder
│  ├─ bathroom/out-of-bed
│  └─ lights_out / wake_final / snooze
├─ Timing Engine
│  ├─ Baseline: median TTFW (14–30 nights)
│  ├─ Same-night nudge ±10–15 min
│  └─ Clamp: 150–240 min (label window)
├─ Storage
│  ├─ Local (Core Data / JSON)
│  └─ CSV export
└─ Outputs
   ├─ Local notification (Dose 2)
   ├─ Haptics
   └─ Insights
